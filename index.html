<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->

        <!-- <link rel="stylesheet" href="css/normalize.css"> -->
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/skeleton.css">
        <style>
        /*
        custom bug squash:
        */
        div[contenteditable=true] {
          -webkit-user-select: auto !important;
          -khtml-user-select: auto !important;
          -moz-user-select: auto !important;
          -ms-user-select: auto !important;
          -o-user-select: auto !important;
          user-select: auto !important;
        }
        .counting {
        	background-color: #eaeaea;
        }
		.vol {
		    margin: 0px;
		    width: 30px;
		    height: 30px;
		    position: relative;
		    float: left;
		    background-color: #bbbbbb;
		    -webkit-user-select: none;
		    -khtml-user-select: none;
		    -moz-user-select: none;
		    -ms-user-select: none;
		    -o-user-select: none;
		    user-select: none;
		}
		.vol.selectedVol:before {
		    content: "";
		    margin-left: 10px;
		    font-size: 20px;
		    line-height: 0;
		    background-color: #dedede;
		    width: 8px;
		    position: absolute;
		    top: 10px;
		    height: 8px;
		    border-radius: 100% 100%;
		    border: solid 1px;
		    box-shadow: inset -1px -2px 4px rgba(0,0,0,0.6);
		}
        </style>
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>
    </head>
    <body>
        <!--[if lte IE 9]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->
    <div class="container editing">
        <div class="row controls">
            <div class="twelve columns">
            	<h2>Meeting Timer with 20 seconds left warning v1.1</h2>
            	<p>This timer becomes slow and will not sound it's alarm if your device goes to sleep.</p>
            </div>

            <div class="twelve columns">
            	<button id="minutes1" class="timers" data-title="1 minute timer">1 minute timer</button>
            	<button id="seconds90"class="timers" data-title="1 1/2 minute timer">1 1/2 minute timer</button>
            	<button id="minutes2" class="timers" data-title="2 minute timer">2 minute timer</button>
			</div>
            <div class="twelve columns">
            	<!-- <button id="playpause">Pause</button> -->
            	<button id="reset">Reset All</button>
            </div>
            <div class="twelve columns volume-control">
	            <div href="#" class="vol" data-vol="0.0" data-title="1 minute timer" style="border-radius: 4px 0px 0px 4px;" id="v0">&nbsp;</div>
	            <div href="#" class="vol" data-vol="0.1" data-title="1 minute timer" id="v1">&nbsp;</div>
	            <div href="#" class="vol" data-vol="0.2" data-title="1 minute timer" id="v2">&nbsp;</div>
	            <div href="#" class="vol" data-vol="0.3" data-title="1 minute timer" id="v3">&nbsp;</div>
	            <div href="#" class="vol" data-vol="0.4" data-title="1 minute timer" id="v4">&nbsp;</div>
	            <div href="#" class="vol" data-vol="0.5" data-title="1 minute timer" id="v5">&nbsp;</div>
	            <div href="#" class="vol" data-vol="0.6" data-title="1 minute timer" id="v6">&nbsp;</div>
	            <div href="#" class="vol" data-vol="0.7" data-title="1 minute timer" id="v7">&nbsp;</div>
	            <div href="#" class="vol" data-vol="0.8" data-title="1 minute timer" id="v8">&nbsp;</div>
	            <div href="#" class="vol" data-vol="0.9" data-title="1 minute timer" id="v9">&nbsp;</div>
	            <div href="#" class="vol" data-vol="1" data-title="1 minute timer" id="v10" style="border-radius: 0px 4px 4px 0px;">&nbsp;</div>
            </div>
        </div>
	</div>
	<audio id="silence" src="silence.wav" preload="auto"></audio>
	<audio id="end" src="end.wav" preload="auto"></audio>
	<audio id="ring" src="ring.wav" preload="auto"></audio>
	    <script src="https://code.jquery.com/jquery-3.2.0.min.js" integrity="sha256-JAW99MJVpJBGcbzEuXk4Az05s/XyDdBomFqNlM3ic+I=" crossorigin="anonymous"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-3.2.0.min.js"><\/script>')</script>
        <script src="js/jquery.min.js"></script>
        <script>
"use strict";

$().ready(function(){

	function MeetingTimer ( targetName, countDownNumber, intervalName ) {
		var miliseconds = 200;
		var passedCountDownNumber = countDownNumber;
	    this.countDownNumber = countDownNumber;
	    var isPlaying = "no";

	    this.currentNumber = function(){
	    	return countDownNumber;
	    }
	    this.playStatus = function(){
	    	return isPlaying;
	    }
	    this.stop = function(){
	    	clearInterval(window.intervalName);
	    	clearInterval(window.intervalNameAudio);
	    	clearInterval(window.intervalNameAudioWarning);
	    	isPlaying = "no";
	    	$(targetName).html("PLAY ("+countDownNumber+" Seconds remaining)");
	    	$(targetName).removeClass("counting");
	    	console.log("STOP CALLED")
	    	// currentCountDownNumber = countDownNumber;
	    }

	    this.set = function(){
	    	
	    }

	    this.play = function(){
			$(targetName).html("PAUSE ("+countDownNumber+" Seconds remaining)");	
	    	isPlaying = "yes";
	    	$(targetName).addClass("counting");

	    	window.intervalName = setInterval(function() {
	    		console.log(countDownNumber+"<before");
	    		if(countDownNumber > 0){
	    			countDownNumber--;
	    			// return
	    		}
	    		console.log(countDownNumber+"<after");
	    		if(countDownNumber < 2){
	    			countDownNumber = passedCountDownNumber; // countDownNumber = countDownNum;
	    			console.log(countDownNumber+"<tested to be more or equal to zero");
	    			// return this.stop();
	    			clearInterval(window.intervalName);
			    	clearInterval(window.intervalNameAudio);
			    	clearInterval(window.intervalNameAudioWarning);
	    			document.getElementById('end').play();
	    			$(targetName).html($(targetName).attr("data-title"));
	    			$(".timers").removeAttr('disabled');
	    			$(targetName).removeClass("counting");
			    	isPlaying = "no";

	    			return
	    		}
	    		$(targetName).html("PAUSE ("+countDownNumber+" Seconds remaining)");

    		}, miliseconds);



	    	if(countDownNumber > 20){

		    	var numcm = countDownNumber*miliseconds-20*miliseconds

		    	
		    	window.intervalNameAudioWarning = setTimeout(function() { 
		    		document.getElementById('ring').play();
				}, numcm);
	    	}
	    		
	    }


	    this.reset = function(){
	    	countDownNumber = passedCountDownNumber;
	    	var targetTitle = $(targetName).attr("data-title");
	    	$(targetName).html(targetTitle);
			clearInterval(window.intervalName);
	    	clearTimeout(window.intervalNameAudio);
			clearTimeout(window.intervalNameAudioWarning);
	    	isPlaying = "no";
	    	$(targetName).removeClass("counting");
	    }

	}

	var mtimer60 = new MeetingTimer("#minutes1",60,"minutes1Timer");
	var mtimer90 = new MeetingTimer("#seconds90",90,"minutes2Timer");
	var mtimer120 = new MeetingTimer("#minutes2",120,"minutes3Timer");

	var resetVol = function(){
		$(".vol").each(function(index){
			var newHeight = $(this).attr("data-vol") * 30;
			var newCss = "inset 0px -"+newHeight+"px 0px rgba(0,0,0,0.4)"
			$(this).css("box-shadow",newCss)
			$(this).removeClass("selectedVol")
		})
	}

	$(".vol").on("click",function(event){
		event.preventDefault()
		document.getElementById("ring").volume = $(this).attr("data-vol");
		resetVol();
		var newHeight = $(this).attr("data-vol") * 30;
		var newCss = "inset 0px -"+newHeight+"px 0px rgba(0,0,0,.5)"
		$(this).css("box-shadow",newCss)
		$(this).addClass("selectedVol");
		// var volumeControl = [];
		// volumeControl.push($(this).attr("id"))
		// volumeControl.push($(this).attr("data-vol"))
		// volumeControl.join(",")
		localStorage.setItem('volumeControl',$(this).attr("id"));
		
	});
		
	if(localStorage.getItem('volumeControl')){
		console.log(localStorage.getItem('volumeControl'))
		$("#"+localStorage.getItem('volumeControl')).click();
	} else {
		$(".vol").last().click();
	}


	$("#minutes1").on("click",function(){
		document.getElementById('silence').play();
		let methods = Object.getOwnPropertyNames(mtimer60);
		console.log(methods+mtimer60.currentNumber());
		if(mtimer60.playStatus() === "no") {
			$(".timers").attr('disabled',true);
			$("#minutes1").removeAttr('disabled');
			mtimer60.play();
		} else {
			$(".timers").removeAttr('disabled');
			mtimer60.stop();
		}
	});
	
	$("#seconds90").on("click",function(){
		document.getElementById('silence').play();
		let methods = Object.getOwnPropertyNames(mtimer60);
		console.log(methods+mtimer90.currentNumber());
		if(mtimer90.playStatus() === "no") {
			$(".timers").attr('disabled',true);
			$("#seconds90").removeAttr('disabled');
			mtimer90.play();
		} else {
			$(".timers").removeAttr('disabled');
			mtimer90.stop();
		}
	});

	$("#minutes2").on("click",function(){
		document.getElementById('silence').play();
		let methods = Object.getOwnPropertyNames(mtimer60);
		console.log(methods+mtimer120.currentNumber());
		if(mtimer120.playStatus() === "no") {
			$(".timers").attr('disabled',true);
			$("#minutes2").removeAttr('disabled');
			mtimer120.play();
		} else {
			$(".timers").removeAttr('disabled');
			mtimer120.stop();
		}
	});

	$("#reset").on("click",function(){
		document.location.reload(true);
		// hacky and slow but reliable.
	});


}); // jquery on ready


        </script>

<style>
/*
    SLOW
*/
@import url('fonts/Tinos-Regular.ttf');
</style>
    </body>
</html>

